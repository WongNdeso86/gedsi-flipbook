<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modul Interaktif Flipbook: Pendidikan Politik GEDSI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>

    <style>
        /* CSS TIDAK BERUBAH DARI SEBELUMNYA, JADI SAYA SINGKAT UNTUK KEJELASAN */
        :root { --primary-color: #0056b3; --secondary-color: #28a745; --background-color: #f0f2f5; --dark-background: #2c3e50; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); margin: 0; display: flex; flex-direction: column; min-height: 100vh; color: #333; }
        .main-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; width: 100%; box-sizing: border-box; }
        .header { width: 100%; text-align: center; margin-bottom: 20px; }
        .header h1 { color: var(--primary-color); margin: 0; }
        .top-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .module-nav button, #fullscreen-btn { background-color: var(--secondary-color); color: white; border: none; padding: 10px 20px; font-size: 1em; font-family: 'Poppins', sans-serif; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
        .module-nav button:hover, #fullscreen-btn:hover { background-color: #218838; }
        .module-nav button.active { background-color: var(--primary-color); transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #fullscreen-btn { background-color: #6c757d; }
        #fullscreen-btn:hover { background-color: #5a6268; }
        .book-container { width: 90vw; max-width: 900px; aspect-ratio: 2 / 1.414; max-height: 636px; }
        #flipbook { width: 100%; height: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.2); border-radius: 5px; }
        .page { background-color: white; overflow: hidden; }
        .page img { width: 100%; height: 100%; object-fit: contain; }
        .page-controls { display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 15px; }
        .page-controls button { background-color: var(--primary-color); color: white; border: none; padding: 10px 20px; font-size: 1em; font-family: 'Poppins', sans-serif; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .page-controls button:hover { background-color: #004494; }
        #page-counter { font-weight: 600; font-size: 1.1em; }
        @media (max-width: 768px) { .book-container { width: 95vw; aspect-ratio: 1 / 1.414; max-height: 80vh; } .top-controls { flex-direction: column; } }
        .main-container:fullscreen { background-color: var(--dark-background); overflow-y: auto; }
        .main-container:fullscreen .book-container { max-width: 95vw; max-height: 95vh; }
    </style>
</head>
<body>

    <div class="main-container" id="main-container">
        <header class="header"><h1>Modul Pendidikan Politik GEDSI</h1></header>

        <div class="top-controls">
            <div class="module-nav">
                <button data-module-index="0">Modul 1</button>
                <button data-module-index="1">Modul 2</button>
                <button data-module-index="2">Modul 3</button>
            </div>
            <button id="fullscreen-btn">Layar Penuh</button>
        </div>
        
        <div class="book-container"><div id="flipbook"></div></div>

        <div class="page-controls">
            <button id="prev-btn">‹ Sebelumnya</button>
            <span id="page-counter"></span>
            <button id="next-btn">Berikutnya ›</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- BAGIAN SCRIPT YANG DIPERBAIKI ---

            const modules = [
                { folder: 'modul1', pageCount: 113 },
                { folder: 'modul2', pageCount: 51 },
                { folder: 'modul3', pageCount: 37 }
            ];

            const flipbookElement = document.getElementById('flipbook');
            const pageCounter = document.getElementById('page-counter');
            const navButtons = document.querySelectorAll('.module-nav button');
            const mainContainer = document.getElementById('main-container');
            const fullscreenBtn = document.getElementById('fullscreen-btn');

            let currentBook = null;

            function loadModule(moduleIndex) {
                console.log(`[INFO] Memulai memuat modul ${moduleIndex + 1}...`);

                // Langkah 1: Hancurkan instance buku lama dengan aman
                if (currentBook && typeof currentBook.destroy === 'function') {
                    console.log("[INFO] Menghancurkan instance buku sebelumnya.");
                    currentBook.destroy();
                }
                currentBook = null;

                // Langkah 2: Kosongkan elemen HTML
                flipbookElement.innerHTML = '';

                // Langkah 3: Siapkan data modul baru
                const selectedModule = modules[moduleIndex];
                if (!selectedModule) {
                    console.error(`[ERROR] Konfigurasi modul untuk index ${moduleIndex} tidak ditemukan!`);
                    return; // Hentikan fungsi jika data tidak ada
                }

                // Langkah 4: Buat halaman-halaman buku baru
                console.log(`[INFO] Membuat ${selectedModule.pageCount} halaman untuk folder '${selectedModule.folder}'...`);
                for (let i = 1; i <= selectedModule.pageCount; i++) {
                    const page = document.createElement('div');
                    page.classList.add('page');
                    
                    const img = document.createElement('img');
                    img.src = `${selectedModule.folder}/${i}.png`;
                    img.alt = `Modul ${moduleIndex + 1} - Halaman ${i}`;
                    img.loading = 'lazy';
                    // Tambahkan error handling untuk gambar
                    img.onerror = function() {
                        console.error(`[ERROR] Gagal memuat gambar: ${this.src}`);
                        this.alt = `Gagal memuat: ${this.src}`; // Tampilkan pesan error di gambar
                    };
                    
                    page.appendChild(img);
                    flipbookElement.appendChild(page);
                }

                // Langkah 5: Inisialisasi PageFlip baru
                try {
                    const book = new St.PageFlip(flipbookElement, {
                        width: 500, height: 707, size: 'stretch',
                        showCover: true, usePortrait: window.innerWidth < 768, maxShadowOpacity: 0.5 
                    });
                    
                    book.loadFromHTML(document.querySelectorAll('.page'));
                    currentBook = book;
                    console.log("[SUCCESS] Buku baru berhasil dibuat dan dimuat!");

                    // Langkah 6: Update UI dan event listener
                    currentBook.on('flip', updatePageCounter);
                    updatePageCounter();
                    
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    navButtons[moduleIndex].classList.add('active');

                } catch (e) {
                    console.error("[FATAL ERROR] Gagal menginisialisasi PageFlip:", e);
                    flipbookElement.innerHTML = '<p style="color:red; text-align:center;">Gagal memuat buku. Cek Console untuk detail error.</p>';
                }
            }

            function updatePageCounter() {
                if (!currentBook) return;
                const currentPage = currentBook.getCurrentPageIndex();
                const totalPages = currentBook.getPageCount();
                const displayPage = (currentPage === 0) ? `1 (Sampul)` : `${currentPage + 1}`;
                pageCounter.textContent = `Halaman ${displayPage} / ${totalPages}`;
            }
            
            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    mainContainer.requestFullscreen().catch(err => {
                        alert(`Gagal masuk mode layar penuh: ${err.message}`);
                    });
                } else { document.exitFullscreen(); }
            }

            // --- Event Listeners ---
            navButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const moduleIndex = parseInt(event.currentTarget.dataset.moduleIndex, 10);
                    loadModule(moduleIndex);
                });
            });

            document.getElementById('prev-btn').addEventListener('click', () => currentBook?.flipPrev());
            document.getElementById('next-btn').addEventListener('click', () => currentBook?.flipNext());
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            // Muat modul pertama saat halaman dibuka
            loadModule(0);
        });
    </script>
</body>
</html>
