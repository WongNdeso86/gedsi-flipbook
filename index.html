<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modul Interaktif Flipbook: Pendidikan Politik GEDSI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>

    <style>
        :root { --primary-color: #0056b3; --secondary-color: #28a745; --background-color: #f0f2f5; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); margin: 0; display: flex; flex-direction: column; min-height: 100vh; color: #333; }
        .main-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; width: 100%; box-sizing: border-box; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: var(--primary-color); margin: 0; }
        .top-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .module-nav button, #fullscreen-btn { background-color: var(--secondary-color); color: white; border: none; padding: 10px 20px; font-size: 1em; font-family: 'Poppins', sans-serif; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
        .module-nav button:hover, #fullscreen-btn:hover { opacity: 0.8; }
        .module-nav button.active { background-color: var(--primary-color); transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #fullscreen-btn { background-color: #6c757d; }
        
        /* PENTING: Container untuk setiap buku */
        .book-wrapper { width: 90vw; max-width: 900px; aspect-ratio: 2 / 1.414; max-height: 636px; }
        .flipbook { width: 100%; height: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.2); border-radius: 5px; }
        .page { background-color: white; overflow: hidden; }
        .page img { width: 100%; height: 100%; object-fit: contain; }
        .page-controls { display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 15px; }
        .page-controls button { background-color: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        #page-counter { font-weight: 600; font-size: 1.1em; }

        /* Sembunyikan buku yang tidak aktif */
        .book-wrapper:not(.active) { display: none; }

        /* STATUS LOG UNTUK DEBUGGING */
        #status-log { margin-top: 15px; padding: 10px; background-color: #fff; border: 1px solid #ddd; border-radius: 5px; font-size: 0.8em; max-height: 100px; overflow-y: auto; width: 90%; max-width: 900px; }
        .log-error { color: red; font-weight: bold; }
        .log-success { color: green; }

        @media (max-width: 768px) { .book-wrapper { width: 95vw; aspect-ratio: 1 / 1.414; max-height: 80vh; } }
    </style>
</head>
<body>
    <div class="main-container" id="main-container">
        <header class="header"><h1>Modul Pendidikan Politik GEDSI</h1></header>

        <div class="top-controls">
            <div class="module-nav">
                <button data-module-index="0">Modul 1</button>
                <button data-module-index="1">Modul 2</button>
                <button data-module-index="2">Modul 3</button>
            </div>
            <button id="fullscreen-btn">Layar Penuh</button>
        </div>
        
        <!-- Tiga container untuk masing-masing buku -->
        <div id="wrapper-modul-0" class="book-wrapper"></div>
        <div id="wrapper-modul-1" class="book-wrapper"></div>
        <div id="wrapper-modul-2" class="book-wrapper"></div>

        <div class="page-controls">
            <button id="prev-btn">‹ Sebelumnya</button>
            <span id="page-counter"></span>
            <button id="next-btn">Berikutnya ›</button>
        </div>

        <!-- Status Log akan muncul di sini -->
        <div id="status-log"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modules = [
                { folder: 'modul1', pageCount: 113 },
                { folder: 'modul2', pageCount: 51 },
                { folder: 'modul3', pageCount: 37 }
            ];

            const navButtons = document.querySelectorAll('.module-nav button');
            const pageCounter = document.getElementById('page-counter');
            const logContainer = document.getElementById('status-log');
            
            let bookInstances = [];
            let currentBook = null;

            function updateStatus(message, type = 'info') {
                const logEntry = document.createElement('div');
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                if (type === 'error') logEntry.classList.add('log-error');
                if (type === 'success') logEntry.classList.add('log-success');
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            function initializeBooks() {
                updateStatus("Mulai inisialisasi semua modul...");

                modules.forEach((module, index) => {
                    const wrapper = document.getElementById(`wrapper-modul-${index}`);
                    const flipbookDiv = document.createElement('div');
                    flipbookDiv.classList.add('flipbook');
                    wrapper.appendChild(flipbookDiv);

                    for (let i = 1; i <= module.pageCount; i++) {
                        const page = document.createElement('div');
                        page.classList.add('page');
                        
                        const img = document.createElement('img');
                        img.src = `${module.folder}/${i}.png`;
                        img.alt = `Modul ${index + 1} - Halaman ${i}`;
                        img.loading = 'lazy';
                        img.onerror = function() {
                            updateStatus(`GAGAL MEMUAT GAMBAR: ${this.src}`, 'error');
                        };
                        
                        page.appendChild(img);
                        flipbookDiv.appendChild(page);
                    }

                    try {
                        const book = new St.PageFlip(flipbookDiv, {
                            width: 500, height: 707, size: 'stretch',
                            showCover: true, usePortrait: window.innerWidth < 768
                        });
                        book.loadFromHTML(flipbookDiv.querySelectorAll('.page'));
                        bookInstances.push(book);
                        updateStatus(`Modul ${index + 1} berhasil dibuat.`, 'success');
                    } catch (e) {
                        updateStatus(`ERROR saat membuat Modul ${index + 1}: ${e.message}`, 'error');
                    }
                });
            }

            function showModule(moduleIndex) {
                document.querySelectorAll('.book-wrapper').forEach((wrapper, index) => {
                    if (index === moduleIndex) {
                        wrapper.classList.add('active');
                    } else {
                        wrapper.classList.remove('active');
                    }
                });

                currentBook = bookInstances[moduleIndex];
                if (!currentBook) {
                    updateStatus(`Buku untuk modul ${moduleIndex + 1} tidak ditemukan!`, 'error');
                    return;
                }
                
                navButtons.forEach((btn, index) => {
                    btn.classList.toggle('active', index === moduleIndex);
                });
                
                currentBook.off('flip'); // Hapus listener lama
                currentBook.on('flip', updatePageCounter); // Tambah listener baru
                updatePageCounter();
            }

            function updatePageCounter() {
                if (!currentBook) return;
                const currentPage = currentBook.getCurrentPageIndex();
                const totalPages = currentBook.getPageCount();
                const displayPage = (currentPage === 0) ? `1 (Sampul)` : `${currentPage + 1}`;
                pageCounter.textContent = `Halaman ${displayPage} / ${totalPages}`;
            }

            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.moduleIndex, 10);
                    showModule(index);
                });
            });

            document.getElementById('prev-btn').addEventListener('click', () => currentBook?.flipPrev());
            document.getElementById('next-btn').addEventListener('click', () => currentBook?.flipNext());
            document.getElementById('fullscreen-btn').addEventListener('click', () => {
                const activeWrapper = document.querySelector('.book-wrapper.active');
                if (activeWrapper && !document.fullscreenElement) {
                    activeWrapper.requestFullscreen().catch(err => alert(`Gagal: ${err.message}`));
                } else { document.exitFullscreen(); }
            });

            initializeBooks();
            if (bookInstances.length > 0) {
                showModule(0); // Tampilkan modul pertama
            } else {
                updateStatus("Tidak ada buku yang berhasil diinisialisasi.", "error");
            }
        });
    </script>
</body>
</html>
